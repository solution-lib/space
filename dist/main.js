#!/usr/bin/env bun
import {cli}from'@je-es/cli';import*as m from'fs';import*as P from'path';import {input,select,confirm}from'@inquirer/prompts';import {spawnSync}from'child_process';var L=Object.defineProperty;var U=(d=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(d,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):d)(function(d){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+d+'" is not supported')});var B=(d,t)=>()=>(d&&(t=d(d=0)),t);var J=(d,t)=>{for(var e in t)L(d,e,{get:t[e],enumerable:true});};var _={};J(_,{TemplateRegistry:()=>b});var b,D=B(()=>{b=class{static{this.TEMPLATES={lib:{type:"lib",defaultTemplate:"clean",templates:[{name:"clean",label:"Clean Library",description:"Zero dependencies - just TypeScript and build tools",repo:"lib",requiresSetup:false,ready:true}]},cli:{type:"cli",defaultTemplate:"clean",templates:[{name:"clean",label:"Clean CLI",description:"Comes with @je-es/cli library for quick CLI development",repo:"cli",deps:["@je-es/cli"],requiresSetup:true,ready:true}]},server:{type:"server",defaultTemplate:"clean",templates:[{name:"clean",label:"Clean Server",description:"Comes with @je-es/server library for quick server development",repo:"server",deps:["@je-es/server"],requiresSetup:true,ready:true}]},web:{type:"web",defaultTemplate:"clean",templates:[{name:"clean",label:"Clean Web App",description:"Comes with @je-es/server and @je-es/client libs for quick web development",repo:"web",deps:["@je-es/server","@je-es/client"],requiresSetup:true,ready:true}]}};}static getTemplatesForType(t,e=false){let r=this.TEMPLATES[t]?.templates||[];return e?r:r.filter(s=>s.ready)}static getReadyTemplatesForType(t){return this.getTemplatesForType(t,false)}static getDefaultTemplate(t){let e=this.TEMPLATES[t];if(!e)return "clean";let r=e.templates.find(a=>a.name===e.defaultTemplate&&a.ready);return r?r.name:e.templates.find(a=>a.ready)?.name||e.defaultTemplate}static getTemplate(t,e){let r=this.TEMPLATES[t];return r?r.templates.find(s=>s.name===e):null}static isTemplateReady(t,e){return this.getTemplate(t,e)?.ready||false}static isValidTemplate(t,e){return this.getTemplatesForType(t).some(s=>s.name===e)}static getRepoName(t,e){return this.getTemplate(t,e)?.repo||"ready-lib"}static getSpaceTypes(){return Object.keys(this.TEMPLATES)}};});D();var j=["name","version","description","keywords","license","homepage","bugs","author","repository","type","main","types","bin","files","exports","scripts","engines","peerDependencies","dependencies","devDependencies"],N=["type","template","pm","repo","author","createdAt"];var k=class{static format(t,e={}){let r=e.indent||"	",s=e.alignColons!==false,a=e.sortKeys||false,i=e.tabWidth||4,n=e.keyOrder||[],u=s?this.calculateGlobalMaxKeyLength(t):0,p=this.calculateMaxDepth(t)*(r==="	"?i:r.length);return this.formatValue(t,0,r,s,a,u,p,i,n)}static formatFile(t,e={}){let r=U("fs"),s=r.readFileSync(t,"utf-8"),a=JSON.parse(s),i=this.format(a,e);r.writeFileSync(t,i+`
`,"utf-8");}static calculateMaxDepth(t,e=0){if(!t||typeof t!="object")return e;let r=e;return Array.isArray(t)?t.forEach(s=>{let a=this.calculateMaxDepth(s,e+1);a>r&&(r=a);}):Object.values(t).forEach(s=>{let a=this.calculateMaxDepth(s,e+1);a>r&&(r=a);}),r}static sortKeys(t,e,r){if(e.length===0)return r?t.sort():t;let s=[],a=[];return t.forEach(i=>{e.includes(i)?s.push(i):a.push(i);}),s.sort((i,n)=>e.indexOf(i)-e.indexOf(n)),r&&a.sort(),[...s,...a]}static calculateGlobalMaxKeyLength(t){let e=0,r=s=>{if(!s||typeof s!="object")return;if(Array.isArray(s)){s.forEach(i=>r(i));return}Object.keys(s).forEach(i=>{let n=JSON.stringify(i).length;n>e&&(e=n),r(s[i]);});};return r(t),e}static formatValue(t,e,r,s,a,i,n,u,g){if(t===null)return "null";if(t===void 0)return "undefined";let p=typeof t;return p==="string"?JSON.stringify(t):p==="number"||p==="boolean"?String(t):Array.isArray(t)?this.formatArray(t,e,r,s,a,i,n,u,g):p==="object"?this.formatObject(t,e,r,s,a,i,n,u,g):JSON.stringify(t)}static formatArray(t,e,r,s,a,i,n,u,g){if(t.length===0)return "[]";if(t.every(l=>typeof l=="string"||typeof l=="number"||typeof l=="boolean"||l===null)&&t.length<=3)return "["+t.map(l=>this.formatValue(l,e,r,s,a,i,n,u,g)).join(", ")+"]";let f=r.repeat(e+1);return `[
`+t.map(l=>f+this.formatValue(l,e+1,r,s,a,i,n,u,g)).join(`,
`)+`
`+r.repeat(e)+"]"}static formatObject(t,e,r,s,a,i,n,u,g){if(Object.keys(t).length===0)return "{}";let p=Object.keys(t);p=this.sortKeys(p,g,a);let f=r.repeat(e+1),v=(e+1)*(r==="	"?u:r.length);return `{
`+p.map(h=>{let y=JSON.stringify(h),o=this.formatValue(t[h],e+1,r,s,a,i,n,u,g);if(s){let x=n-v,C=i-y.length,q=" ".repeat(x+C);return `${f}${y}${q} : ${o}`}else return `${f}${y} : ${o}`}).join(`,
`)+`
`+r.repeat(e)+"}"}};var R=class{constructor(t=process.cwd()){this.basePath=t;}async createSpace(t,e){let r=e||P.join(this.basePath,t.repo.name);if(m.existsSync(r))throw new Error(`Space path "${r}" already exists!`);let s=false;try{m.existsSync(r)||(m.mkdirSync(r,{recursive:!0}),s=!0),await this.cloneTemplate(t.type,r,t,t.template),this.createSpaceConfig(r,t);}catch(a){if(s&&m.existsSync(r))try{await this.safeDeleteDirectory(r);}catch{console.warn(`Warning: Could not clean up directory at "${r}"`);}throw a}}loadSpaceConfig(t){let e=t||this.basePath,r=P.join(e,".space");if(!m.existsSync(r))return null;let s=m.readFileSync(r,"utf-8");return JSON.parse(s)}isSpace(t){let e=t||this.basePath;return m.existsSync(P.join(e,".space"))}async cloneTemplate(t,e,r,s){let i=`https://github.com/solution-dist/${b.getRepoName(t,s)}.git`;try{let{execSync:n}=await import('child_process');n(`git clone --quiet --depth 1 ${i} "${e}"`,{stdio:"pipe"});let u=P.join(e,".git");m.existsSync(u)&&await this.safeDeleteDirectory(u),await this.updateTemplateFiles(e,r);}catch(n){throw n.message&&n.message.includes("Repository not found")?new Error(`Template repository not found: ${i}
This template is not yet available. Please mark it as ready: false in templateRegistry.ts`):new Error(`Failed to clone template from ${i}: ${n.message||n}`)}}async updateTemplateFiles(t,e){let r=e.repo.org&&e.repo.org.trim()!=="",s=e.author.id&&e.author.id.trim()!=="",a=r?e.repo.org:s?e.author.id:"",i=a?`git+https://github.com/${a}/${e.repo.name}.git`:"",n=a?`https://github.com/${a}/${e.repo.name}#readme`:"",u=a?`https://github.com/${a}/${e.repo.name}/issues`:"",g=r?`@${e.repo.org}/${e.repo.name}`:e.repo.name,p="\u{1F525}-";r?p+=`@${(e.repo.org.replace(/-/g,"--")+"/"+e.repo.name.replace(/-/g,"--")).replace(/ /g,"_")}`:e.author.name?p+=(e.author.name.replace(/-/g,"--")+"/"+e.repo.name.replace(/-/g,"--")).replace(/ /g,"_"):p+=e.repo.name.replace(/-/g,"--").replace(/ /g,"_");let f=s?`https://github.com/${e.author.id}`:e.author.url||"",v=this.getAllFiles(t);for(let l of v)if(!(l.includes("node_modules")||l.includes(".git")))try{let h=m.readFileSync(l,"utf-8"),y=!1;if(h.includes("{{")&&(y=!0,h=h.replace(/\{\{tag\}\}/g,g).replace(/\{\{tag-badge\}\}/g,p).replace(/\{\{name\}\}/g,e.repo.name).replace(/\{\{repo\}\}/g,e.repo.name).replace(/\{\{org\}\}/g,e.repo.org||"").replace(/\{\{desc\}\}/g,e.repo.desc||`A ${e.type} space`).replace(/\{\{description\}\}/g,e.repo.desc||`A ${e.type} space`).replace(/\{\{version\}\}/g,e.repo.version).replace(/\{\{license\}\}/g,e.repo.license||"MIT").replace(/\{\{url\}\}/g,i).replace(/\{\{repo_url\}\}/g,i).replace(/\{\{git_url\}\}/g,i).replace(/\{\{homepage\}\}/g,n).replace(/\{\{issues\}\}/g,u).replace(/\{\{type\}\}/g,e.type).replace(/\{\{template\}\}/g,e.template||"clean").replace(/\{\{pm\}\}/g,e.pm).replace(/\{\{author\}\}/g,e.author.name||"").replace(/\{\{author_name\}\}/g,e.author.name||"").replace(/\{\{author_id\}\}/g,e.author.id||"").replace(/\{\{author_email\}\}/g,e.author.email||"").replace(/\{\{author_url\}\}/g,f),m.writeFileSync(l,h,"utf-8")),l.endsWith("package.json")){let o=JSON.parse(h);if(o.name=g,o.version=e.repo.version,o.description=e.repo.desc||`A ${e.type} space`,o.license=e.repo.license||"MIT",e.repo.kw&&e.repo.kw.length>0?o.keywords=e.repo.kw:o.keywords=[],n&&(o.homepage=n),u&&(o.bugs||(o.bugs={}),o.bugs.url=u),e.author.name&&(e.author.email?o.author={name:e.author.name,email:e.author.email,url:f||void 0}:o.author={name:e.author.name,url:f||void 0}),i&&(o.repository={type:"git",url:i}),e.type==="cli"&&o.bin){let x=Object.keys(o.bin)[0],C=o.bin[x];delete o.bin[x],o.bin[e.repo.name]=C;}o.engines||(o.engines={}),o.engines.bun||(o.engines.bun=">=1.0.0"),h=k.format(o,{keyOrder:j}),m.writeFileSync(l,h+`
`,"utf-8");continue}}catch{continue}}getAllFiles(t,e=[]){return m.readdirSync(t).forEach(s=>{let a=P.join(t,s);m.statSync(a).isDirectory()?e=this.getAllFiles(a,e):e.push(a);}),e}createSpaceConfig(t,e){let r=P.join(t,".space"),s=e.repo.org&&e.repo.org.trim()!=="",a=e.author.id&&e.author.id.trim()!=="",i=s?e.repo.org:a?e.author.id:"",n=i?`git+https://github.com/${i}/${e.repo.name}.git`:"",u=i?`https://github.com/${i}/${e.repo.name}#readme`:"",g=i?`https://github.com/${i}/${e.repo.name}/issues`:"",p=a?`https://github.com/${e.author.id}`:e.author.url||"",f={type:e.type,template:e.template||"clean",pm:e.pm,repo:{org:e.repo.org||"",name:e.repo.name,version:e.repo.version,desc:e.repo.desc||`A ${e.type} space`,kw:e.repo.kw||[],license:e.repo.license||"MIT",issues:g,homepage:u,git_url:n},author:{id:e.author.id||"",name:e.author.name||"",email:e.author.email||"",url:p},createdAt:new Date().toISOString()},v=k.format(f,{keyOrder:N});m.writeFileSync(r,v+`
`,"utf-8");}async safeDeleteDirectory(t,e=3){for(let r=0;r<e;r++)try{if(m.rmSync(t,{recursive:!0,force:!0,maxRetries:3,retryDelay:100}),!m.existsSync(t))return}catch(s){if(r===e-1)throw s;await new Promise(a=>setTimeout(a,300*(r+1)));}}};var O=class{constructor(){this.pm="bun";this.DEFAULT_SCRIPTS={build:"tsup",test:"test"};}install(t,e){let r=[];e?.global?(r.push("install","--global"),t&&t.length>0?r.push(...t):(console.error("\u2718 Please specify packages to install globally"),process.exit(1))):(r.push("install"),t&&t.length>0&&r.push(...t),e?.dev&&r.push("--dev")),console.log(`\u2192 Installing${t?` ${t.join(", ")}`:" dependencies"}${e?.global?" globally":""}...`),this.execute(r),e?.global||this.format();}remove(t,e){let r=["remove"];e?.global&&r.push("--global"),r.push(...t),console.log(`\u{1F5D1}\uFE0F Removing ${t.join(", ")}${e?.global?" globally":""}...`),this.execute(r),e?.global||this.format();}link(t){t?(console.log(`\u{1F517} Linking global package "${t}" to current project...`),this.execute(["link",t])):(console.log("\u{1F517} Linking current package globally..."),this.execute(["link"]));}unlink(t){t?(console.log(`\u{1F513} Unlinking global package "${t}" from current project...`),this.execute(["unlink",t])):(console.log("\u{1F513} Unlinking current package globally..."),this.execute(["unlink"]));}run(t,e){let r=this.getScriptCommand(t);if(r||(console.error(`\u2718 Script "${t}" not found in package.json and no default available`),process.exit(1)),this.isUsingDefaultScript(t)){let a=[...r.split(" ")];e&&e.length>0&&a.push(...e),this.execute(a);}else {let s=["run",t];e&&e.length>0&&s.push("--",...e),this.execute(s);}}runSilent(t,e){let r=this.getScriptCommand(t);if(!r)throw new Error(`Script "${t}" not found in package.json and no default available`);if(this.isUsingDefaultScript(t)){let a=[...r.split(" ")];e&&e.length>0&&a.push(...e),this.executeSilent(a);}else {let s=["run",t];e&&e.length>0&&s.push("--",...e),this.executeSilent(s);}}update(t){console.log(`\u{1F504} Updating${t?` ${t.join(", ")}`:" all packages"}...`);let e=["update"];t&&t.length>0&&e.push(...t),this.execute(e),this.format();}list(t){let e=["pm","ls"];t?.global&&e.push("--global"),this.execute(e);}init(){console.log("\u{1F4DD} Initializing package.json..."),this.execute(["init","-y"]),this.format();}publish(t,e){let r=["publish"];t?.tag&&r.push("--tag",t.tag);let s=t?.access||"public";r.push("--access",s);let a=Bun.spawnSync(["bun",...r],{stdout:"pipe",stderr:"pipe"});if(a.exitCode===0){let n=new TextDecoder().decode(a.stdout).match(/\+ (.+@[\d.]+)/);e?n?e.stop(`\u2714 Published ${n[1]} successfully!`):e.stop("\u2714 Published successfully!"):console.log(n?`\u2714 Published ${n[1]} successfully!`:"\u2714 Published successfully!");}else {let i=new TextDecoder().decode(a.stderr);e?e.stopWithError("Publish failed!"):console.error("Publish failed!"),i&&console.error(i),process.exit(1);}}execute(t){Bun.spawnSync(["bun",...t],{stdout:"inherit",stderr:"inherit"}).exitCode!==0&&(console.error(`\u2718 Command failed: bun ${t.join(" ")}`),process.exit(1));}executeSilent(t){let e=Bun.spawnSync(["bun",...t],{stdout:"pipe",stderr:"pipe"});if(e.exitCode!==0){let r=new TextDecoder().decode(e.stderr);console.error(`\u2718 Command failed: bun ${t.join(" ")}`),r&&console.error(r),process.exit(1);}}getName(){return "bun"}getEmoji(){return "\u{1F95F}"}format(){try{let t=P.join(process.cwd(),"package.json");m.existsSync(t)&&k.formatFile(t,{keyOrder:j});}catch{}}getScriptCommand(t){let e=P.join(process.cwd(),"package.json");if(m.existsSync(e))try{let r=JSON.parse(m.readFileSync(e,"utf-8"));if(r.scripts&&r.scripts[t])return r.scripts[t]}catch{}return t in this.DEFAULT_SCRIPTS?this.DEFAULT_SCRIPTS[t]:null}isUsingDefaultScript(t){let e=P.join(process.cwd(),"package.json");if(m.existsSync(e))try{let r=JSON.parse(m.readFileSync(e,"utf-8"));if(r.scripts&&r.scripts[t])return !1}catch{}return t in this.DEFAULT_SCRIPTS}};D();var c=class{static async promptInit(t){let e=t.name,r=t.type,s=t.template,a=t.desc,i="";if((!e||e==="my-space")&&(e=await input({message:"name:",default:"my-space",validate:l=>{if(!l||l.trim()==="")return "Space name is required";let h=/^@([a-z0-9-_]+)\/([a-z0-9-_]+)$/,y=/^[a-z0-9-_]+$/;return !h.test(l)&&!y.test(l)?'Name must be either "package-name" or "@org/package-name" (lowercase, numbers, hyphens, underscores only)':true}})),!r){let l=b.getTemplatesForType("lib",false).length>0,h=b.getTemplatesForType("cli",false).length>0,y=b.getTemplatesForType("server",false).length>0,o=b.getTemplatesForType("web",false).length>0;r=await select({message:"type:",choices:[{name:`\u2192 Library    - TypeScript library for npm${l?"":" (Coming Soon)"}`,value:"lib",disabled:l?false:"No templates ready yet"},{name:`\u2192 CLI        - Command-line tool${h?"":" (Coming Soon)"}`,value:"cli",disabled:h?false:"No templates ready yet"},{name:`\u2192 Server     - Backend server application${y?"":" (Coming Soon)"}`,value:"server",disabled:y?false:"No templates ready yet"},{name:`\u2192 Web App    - Full-stack web application${o?"":" (Coming Soon)"}`,value:"web",disabled:o?false:"No templates ready yet"}]});}if(!s){let l=b.getTemplatesForType(r,true);if(l.filter(o=>o.ready).length===0)throw new Error(`No templates are ready yet for "${r}" spaces. This space type is coming soon!`);let y=l.map(o=>{let x=o.ready?"\u2714":"\u{1F6A7}",C=o.ready?"":" (Coming Soon)";return {name:`${x} ${o.label}${C} - ${o.description}`,value:o.name,short:o.label,disabled:o.ready?false:"Not ready yet"}});s=await select({message:"template:",choices:y,default:b.getDefaultTemplate(r)});}a||(a=await input({message:"desc:",default:r==="lib"?"A TypeScript library":r==="cli"?"A command-line tool":"A backend server"}));let n="bun";i=await input({message:"author name:",default:""});let u=await input({message:"author email:",default:"",validate:l=>l&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?"Please enter a valid email address or leave empty":true}),g=await input({message:"github username:",default:"",validate:l=>l&&!/^[a-z0-9]([a-z0-9-]*[a-z0-9])?$/i.test(l)?"Please enter a valid GitHub username or leave empty":true}),p=await input({message:"keywords (comma-separated):",default:""}),f=p?p.split(",").map(l=>l.trim()).filter(l=>l):[],v=await input({message:"license:",default:"MIT"});return {name:e,type:r,template:s,description:a,packageManager:n,author:i,authorEmail:u,githubId:g,keywords:f,license:v}}static async promptPublish(t){if(!await confirm({message:`Are you sure you want to publish "${t}" to npm?`,default:false}))return {confirm:false};let r=await input({message:"Publish with a tag (e.g., beta, next) or leave empty for latest:",default:""}),s=await select({message:"\u{1F510} Access level:",choices:[{name:"Public - Anyone can install",value:"public"},{name:"Restricted - Requires authentication",value:"restricted"}],default:"public"});return {confirm:true,tag:r||void 0,access:s}}static async promptRemove(t){let e=await confirm({message:`Remove ${t.join(", ")}?`,default:true});return {packages:t,confirm:e}}static async promptConfirm(t,e=false){let s=(await import('readline')).createInterface({input:process.stdin,output:process.stdout}),a=e?" (Y/n)":" (y/N)";return new Promise(i=>{s.question(`${t}${a} `,n=>{s.close(),n.trim()===""?i(e):i(n.trim().toLowerCase()==="y"||n.trim().toLowerCase()==="yes");});})}static async promptInstall(t){let e=await input({message:"Enter package names (space-separated):",default:t||"",validate:s=>!s||s.trim()===""?"Please enter at least one package name":true}),r=await confirm({message:"\u{1F6E0}\uFE0F  Install as dev dependency?",default:false});return {packages:e.split(" ").filter(s=>s.trim()),isDev:r}}static async promptUpdate(){return await select({message:"What do you want to update?",choices:[{name:"All packages",value:"all"},{name:"Specific packages",value:"specific"}]})==="all"?{updateAll:true}:{updateAll:false,packages:(await input({message:"\u{1F4E6} Enter package names (space-separated):",validate:r=>!r||r.trim()===""?"Please enter at least one package name":true})).split(" ").filter(r=>r.trim())}}static async promptUseCurrentDir(t){return await confirm({message:`Use current directory "${t}" as the space root?`,default:true})}static async promptDeleteExistingDir(t){return await confirm({message:`\u26A0\uFE0F  Directory already exists at "${t}". Delete and recreate?`,default:false})}static showSuccess(t,e){console.log(""),e.forEach((r,s)=>{console.log(`\u2192 ${r}`);}),console.log("");}static showError(t,e){console.log(`
\u2718 Error:`,t),e&&e.message&&console.log(`   ${e.message}`),console.log("");}static showWarning(t){console.log(`
\u26A0\uFE0F  Warning:`,t),console.log("");}static showInfo(t){console.log(`
\u2139\uFE0F  `,t),console.log("");}};var E=class{constructor(){this.frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];this.currentFrame=0;this.interval=null;}start(t){process.stdout.write(`
${t}`),this.interval=setInterval(()=>{process.stdout.write(`\r${this.frames[this.currentFrame]} ${t}`),this.currentFrame=(this.currentFrame+1)%this.frames.length;},80);}stop(t){this.interval&&(clearInterval(this.interval),this.interval=null),t===""?process.stdout.write("\r\x1B[K\x1B[1A\x1B[K"):process.stdout.write(`\r${t}                          

`);}stopWithError(t){this.interval&&(clearInterval(this.interval),this.interval=null),process.stdout.write(`\r\u2718 ${t}                          

`);}},M=class d{constructor(t){this.config=t;this.pm=null;this.spaceManager=new R,this.initPackageManager();}static create(t){return new d(t)}run(){cli(this.config.name,this.config.version).description(this.config.desc).command({name:"init",description:"Create a new space (lib or cli)",args:[{name:"name",required:false,default:"my-space",description:"Name of the space (supports @org/name format)"}],options:[{name:"type",flag:"-t",type:"string",required:false,description:"Type of space (lib or cli)"},{name:"description",flag:"--desc",type:"string",required:false,description:"Description of the space"}],action:t=>this.createNewSpaceOnGroundViaCLI(t)}).command({name:"info",description:"Show current space information",action:()=>this.showSpaceInfo()}).command({name:"install",aliases:["i"],description:"Install packages",args:[{name:"packages",required:false,description:"Packages to install (space-separated)"}],options:[{name:"dev",flag:"--dev",type:"boolean",required:false,description:"Install as dev dependency"},{name:"global",flag:"--global",type:"boolean",required:false,description:"Install globally"}],action:t=>this.installPackages(t)}).command({name:"remove",aliases:["r"],description:"Remove packages",args:[{name:"packages",required:true,description:"Packages to remove (space-separated)"}],options:[{name:"global",flag:"--global",type:"boolean",required:false,description:"Remove globally"}],action:t=>this.removePackages(t)}).command({name:"update",aliases:["up"],description:"Update packages",args:[{name:"packages",required:false,description:"Packages to update (space-separated, or all if empty)"}],action:t=>this.updatePackages(t)}).command({name:"link",description:"Link package globally (no args) or link global package to project (with package name)",args:[{name:"package",required:false,description:"Package name to link from global (optional)"}],action:t=>this.linkPackage(t)}).command({name:"unlink",description:"Unlink package globally (no args) or unlink global package from project (with package name)",args:[{name:"package",required:false,description:"Package name to unlink from global (optional)"}],action:t=>this.unlinkPackage(t)}).command({name:"list",aliases:["ls"],description:"List installed packages",options:[{name:"global",flag:"--global",type:"boolean",required:false,description:"List global packages"}],action:t=>this.listPackages(t)}).command({name:"build",description:"Build the current space",action:()=>this.buildSpace()}).command({name:"test",description:"Run tests for the current space",args:[{name:"path",required:false,description:"Specific test file or folder (optional)"}],options:[{name:"coverage",flag:"--coverage",type:"boolean",required:false,description:"Generate code coverage report"},{name:"watch",flag:"--watch",type:"boolean",required:false,description:"Run tests in watch mode"},{name:"bail",flag:"--bail",type:"boolean",required:false,description:"Exit on first test failure"},{name:"timeout",flag:"--timeout",type:"string",required:false,description:"Set test timeout in milliseconds"},{name:"rerun-each",flag:"--rerun-each",type:"string",required:false,description:"Re-run each test N times"},{name:"concurrent",flag:"--concurrent",type:"boolean",required:false,description:"Run tests concurrently"},{name:"coverage-reporter",flag:"--coverage-reporter",type:"string",required:false,description:"Coverage reporter format (text, lcov, etc.)"},{name:"test-name-pattern",flag:"-t",type:"string",required:false,description:"Filter tests by name pattern"}],action:t=>this.runTests(t)}).command({name:"run",description:"Run any script from package.json",args:[{name:"script",required:true,description:"Script name from package.json"}],allowDynamicArgs:true,allowDynamicOptions:true,action:t=>this.runScript(t)}).command({name:"clean",description:"Clean build artifacts",action:()=>this.clean()}).command({name:"start",description:"Start the main file",allowDynamicArgs:true,allowDynamicOptions:true,action:t=>this.startMain(t)}).command({name:"publish",description:"Publish space to npm registry",options:[{name:"tag",flag:"--tag",type:"string",required:false,description:"Publish with tag (e.g., beta, next)"},{name:"access",flag:"--access",type:"string",required:false,description:"Access level (public or restricted)"}],action:t=>this.publish(t)}).build().run();}static defaultConfig(){return {name:"Space",version:"0.0.1",desc:"Build flexible spaces for any platform"}}initPackageManager(){this.spaceManager.isSpace()&&(this.pm=new O);}ensureSpace(){return this.spaceManager.isSpace()?true:(console.error('\u2718 Not a space directory. Run "space init <name> -t lib|cli" first.'),false)}parsePackageName(t){let e=/^@([a-z0-9-_]+)\/([a-z0-9-_]+)$/i,r=t.match(e);return r?{org:r[1],name:r[2]}:{org:"",name:t}}async deleteDirectoryWithRetry(t,e=3){for(let r=0;r<e;r++)try{if(m.rmSync(t,{recursive:!0,force:!0,maxRetries:3,retryDelay:100}),!m.existsSync(t))return}catch(s){if(r===e-1)throw s;await new Promise(a=>setTimeout(a,500*(r+1)));}throw new Error("Failed to delete directory after multiple attempts")}async createNewSpaceOnGroundViaCLI(t){try{let e=await c.promptInit({type:t.options.type,template:t.options.template,org:"",name:t.args.name,desc:t.options.desc}),{org:r,name:s}=this.parsePackageName(e.name);["lib","cli","server"].includes(e.type)||(c.showError("Invalid space type. Must be lib, cli or server."),process.exit(1));let{TemplateRegistry:a}=await Promise.resolve().then(()=>(D(),_));a.isValidTemplate(e.type,e.template)||(c.showError("Invalid template for this space type."),process.exit(1)),a.isTemplateReady(e.type,e.template)||(c.showError("This template is not ready yet. Please choose another template."),process.exit(1));let i,n=P.basename(process.cwd());if(!s||s.trim()===""?await c.promptUseCurrentDir(n)?i=process.cwd():(c.showError("Space name is required when not using current directory"),process.exit(1)):n===s&&await c.promptUseCurrentDir(s)&&(i=process.cwd()),i||(i=P.join(process.cwd(),s)),m.existsSync(i)){m.statSync(i).isDirectory()||(c.showError(`Path "${i}" exists but is not a directory`),process.exit(1)),await c.promptDeleteExistingDir(i)||(c.showInfo("Space creation cancelled"),process.exit(0));try{await this.deleteDirectoryWithRetry(i);}catch(p){p.message&&(p.message.includes("EBUSY")||p.message.includes("EPERM")||p.message.includes("resource busy"))?c.showError(`Cannot delete directory - it's being used by another program.

Please try:
  1. Close any terminals/editors with "${i}" open
  2. Navigate out of the directory in all terminals
  3. Run PowerShell/Terminal as Administrator
  4. Wait a few seconds and try again`):c.showError("Failed to delete existing directory.",p),process.exit(1);}}await this.spaceManager.createSpace({type:e.type,template:e.template,pm:"bun",repo:{org:r,name:s,version:"0.0.1",desc:e.description,kw:e.keywords.length>0?e.keywords:[],license:e.license||"MIT"},author:{id:e.githubId,name:e.author,email:e.authorEmail,url:""},createdAt:new Date().toISOString()},i),c.showSuccess(s,[i===process.cwd()?"space install":`cd ${s}`,"space install","space build"]);}catch(e){c.showError("Failed to create space",e),process.exit(1);}}showSpaceInfo(){if(!this.ensureSpace())return;let t=this.spaceManager.loadSpaceConfig();if(!t){console.error("\u2718 Could not load space configuration.");return}console.log("");let r=t.repo?.org&&t.repo.org.trim()!==""?`${t.repo.org}/${t.repo.name}`:t.repo.name;if(console.log(`Name:            ${r}`),console.log(`Type:            ${t.type}`),console.log(`Version:         ${t.repo.version}`),t.repo.desc&&t.repo.desc!=="{{desc}}"&&t.repo.desc!=="{{description}}"&&console.log(`Description:     ${t.repo.desc}`),t.repo.kw){let s=[];if(Array.isArray(t.repo.kw))s=t.repo.kw.filter(a=>a&&typeof a=="string"&&a.trim()!==""&&a!=="{{kw}}"&&a!=="{{keywords}}");else if(typeof t.repo.kw=="string"){let a=t.repo.kw;a!=="{{kw}}"&&a!=="{{keywords}}"&&a.trim()!==""&&(s=a.split(",").map(i=>i.trim()).filter(i=>i!==""));}s.length>0&&console.log(`Keywords:        ${s.join(", ")}`);}t.repo.license&&t.repo.license!=="{{license}}"&&console.log(`License:         ${t.repo.license}`),console.log("PackageManager:  bun"),t.author?.name&&t.author.name!=="{{author}}"&&t.author.name!=="{{author_name}}"&&console.log(`Author:          ${t.author.name}`),console.log(`Created:         ${new Date(t.createdAt).toLocaleDateString()}`),console.log("");}async installPackages(t){if(this.ensureSpace()){this.pm||this.initPackageManager();try{let e=t.args.packages?t.args.packages.split(" ").filter(s=>s.trim()):void 0,r=t.options.dev||!1;if((!e||e.length===0)&&!await c.promptConfirm("No packages specified. Install all dependencies from package.json?",!0)){let a=await c.promptInstall();e=a.packages,r=a.isDev;}this.pm.install(e,{dev:r,global:t.options.global});}catch(e){c.showError("\u2718 Installation failed",e),process.exit(1);}}}async removePackages(t){if(this.ensureSpace()){this.pm||this.initPackageManager();try{let e=t.args.packages.split(" ").filter(s=>s.trim());if(e.length===0){c.showError("Please specify packages to remove");return}if(!(await c.promptRemove(e)).confirm){c.showInfo("Removal cancelled");return}this.pm.remove(e,{global:t.options.global});}catch(e){c.showError("\u2718 Removal failed",e),process.exit(1);}}}async updatePackages(t){if(this.ensureSpace()){this.pm||this.initPackageManager();try{let e=t.args.packages?t.args.packages.split(" ").filter(r=>r.trim()):void 0;if(!e||e.length===0){let r=await c.promptUpdate();e=r.updateAll?void 0:r.packages;}this.pm.update(e);}catch(e){c.showError("\u2718 Update failed",e),process.exit(1);}}}linkPackage(t){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let e=t?.args?.package;this.pm.link(e);}unlinkPackage(t){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let e=t?.args?.package;this.pm.unlink(e);}listPackages(t){this.ensureSpace()&&(this.pm||this.initPackageManager(),this.pm.list({global:t.options.global}));}runScript(t){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let e=t?.args?.script;if(!e){c.showError("Please specify a script name");return}try{let r=[];if(t?.dynamicArgs&&Array.isArray(t.dynamicArgs)&&r.push(...t.dynamicArgs),t?.dynamicOptions&&typeof t.dynamicOptions=="object")for(let[s,a]of Object.entries(t.dynamicOptions))r.push(`--${s}`),a!==!0&&a!==!1&&r.push(String(a));this.pm.run(e,r.length>0?r:void 0);}catch(r){c.showError(`Failed to run script "${e}"`,r),process.exit(1);}}buildSpace(t){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let e=new E;e.start("Building space...");try{this.pm.runSilent("build"),e.stop(t?"":"\u2714 Build succeeded");}catch{e.stopWithError("\u2718 Build failed"),process.exit(1);}}buildSpaceBool(t){if(!this.ensureSpace())return  false;this.pm||this.initPackageManager();let e=new E;e.start("Building space...");try{return this.pm.runSilent("build"),e.stop(t?"":"\u2714 Build succeeded"),!0}catch{return e.stopWithError("\u2718 Build failed!"),false}}runTests(t){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let e=[],r=t?.args?.path;r&&e.push(r),t?.options?.coverage&&e.push("--coverage"),t?.options?.["coverage-reporter"]&&e.push("--coverage-reporter",t.options["coverage-reporter"]),t?.options?.watch&&e.push("--watch"),t?.options?.bail&&e.push("--bail"),t?.options?.timeout&&e.push("--timeout",t.options.timeout),t?.options?.["rerun-each"]&&e.push("--rerun-each",t.options["rerun-each"]),t?.options?.concurrent&&e.push("--concurrent"),t?.options?.["test-name-pattern"]&&e.push("-t",t.options["test-name-pattern"]),e.length>0?this.pm.run("test",e):this.pm.run("test");}clean(){if(!this.ensureSpace())return;this.pm||this.initPackageManager();let t=new E;t.start("Cleaning build artifacts...");try{this.pm.run("clean"),t.stop("\u2714 Clean complete!");}catch{t.stopWithError("\u2718 Clean failed!"),process.exit(1);}}startMain(t){if(this.buildSpaceBool(true))try{let e=this.findBuiltMainFile();e||(c.showError(`Could not find built entry point.
Expected to find dist/main.js or dist/index.js after build.`),process.exit(1));let r=[];if(t?.dynamicArgs&&Array.isArray(t.dynamicArgs)&&r.push(...t.dynamicArgs),t?.dynamicOptions&&typeof t.dynamicOptions=="object")for(let[a,i]of Object.entries(t.dynamicOptions))r.push(`--${a}`),i!==!0&&i!==!1&&r.push(String(i));r.length>0;let s=spawnSync("bun",[e,...r],{stdio:"inherit",cwd:process.cwd()});s.error&&(c.showError("Failed to start process",s.error),process.exit(1)),s.status!==0&&s.status!==null&&(console.error(`
\u2718 Process exited with error`),process.exit(s.status));}catch(e){c.showError("Failed to start",e),process.exit(1);}}findBuiltMainFile(){let t=["dist/main.js","dist/index.js","dist/app.js"];for(let e of t)if(m.existsSync(P.join(process.cwd(),e)))return e;try{let e=P.join(process.cwd(),"package.json");if(m.existsSync(e)){let r=JSON.parse(m.readFileSync(e,"utf-8"));if(r.main&&m.existsSync(r.main))return r.main}}catch{}return null}async publish(t){if(this.buildSpaceBool(true))try{let e=this.spaceManager.loadSpaceConfig();if(!e){c.showError("Could not load space configuration");return}let r=e.repo.org?`@${e.repo.org}/${e.repo.name}`:e.repo.name,s=t.options.tag,a=t.options.access;if(!s&&!a){let n=await c.promptPublish(r);if(!n.confirm){c.showInfo("Publish cancelled");return}s=n.tag,a=n.access;}let i=new E;i.start("Publishing package..."),this.pm.publish({tag:s,access:a},i);}catch(e){c.showError("Publish failed",e),process.exit(1);}}};var W=M.create({name:"Space",version:"0.0.2",desc:"Build flexible spaces for any platform"});W.run();//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map